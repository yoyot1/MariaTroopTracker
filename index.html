<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maria Troop Tracker</title>
    <link rel="icon" type="image/jpeg" href="images/maria-thumbnail.jpg">
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
    <div class="app-header">
        <img src="images/maria-thumbnail.jpg" alt="Maria Game" class="game-logo">
        <h1>Maria Troop Tracker</h1>
    </div>
    <p>Choose which nation you control:</p>
    <div class="nation-select">
        <button class="nation-button" onclick="selectNation('france')">
            <img src="images/role_france.2x.png" alt="France" class="nation-icon">
            <span class="nation-name">France</span>
        </button>
        <button class="nation-button" onclick="selectNation('austria')">
            <img src="images/role_austria.2x.png" alt="Austria" class="nation-icon">
            <span class="nation-name">Austria</span>
        </button>
        <button class="nation-button" onclick="selectNation('prussia')">
            <div class="nation-icons left">
                <img src="images/role_prussia.2x.png" alt="Prussia" class="nation-icon">
            </div>
            <span class="nation-name">Prussia/Pragmatic Army</span>
            <div class="nation-icons right">
                <img src="images/role_pragmatic.2x.png" alt="Pragmatic Army" class="nation-icon">
            </div>
        </button>
    </div>

    <button class="reset-button" onclick="showResetConfirmation()">Reset All Troops to Starting Values</button>

    <!-- Add modal dialog -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3>Reset Confirmation</h3>
            <p>Are you sure you want to reset all troops to their starting values? This cannot be undone.</p>
            <div class="modal-buttons">
                <button class="modal-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-confirm" onclick="resetToStartingValues()">Reset</button>
            </div>
        </div>
    </div>

    <script>
        function selectNation(nation) {
            window.location.href = `tracker.html?nation=${nation}`;
        }

        function checkNationModifications() {
            const saxonyModifier = localStorage.getItem('saxonyModifier');
            const saxonySwitched = localStorage.getItem('saxonySwitched') === 'true';
            const generalsData = JSON.parse(localStorage.getItem('generalsData') || '{}');
            
            // Check for troop modifications
            const hasModifications = (nation) => {
                if (!generalsData[nation]) return false;
                return Object.entries(generalsData[nation]).some(([general, troops]) => {
                    const originalGeneral = nationGenerals[nation]?.find(g => g.name === general);
                    return (originalGeneral?.troops || 0) !== troops;
                });
            };

            // Add modified class for both Saxony changes and troop modifications
            const austriaButton = document.querySelector('.nation-button[onclick*="austria"]');
            const prussiaButton = document.querySelector('.nation-button[onclick*="prussia"]');
            const franceButton = document.querySelector('.nation-button[onclick*="france"]');

            if (austriaButton) {
                austriaButton.classList.toggle('modified', 
                    (saxonySwitched && saxonyModifier?.toLowerCase() === 'austria') || 
                    hasModifications('Austria') ||
                    (saxonySwitched && hasModifications('Saxony')));
            }
            if (prussiaButton) {
                prussiaButton.classList.toggle('modified', 
                    (saxonySwitched && saxonyModifier?.toLowerCase() === 'prussia') || 
                    hasModifications('Prussia') || 
                    hasModifications('Pragmatic Army') ||
                    (!saxonySwitched && hasModifications('Saxony')));
            }
            if (franceButton) {
                franceButton.classList.toggle('modified', 
                    hasModifications('France') || 
                    hasModifications('Bavaria'));
            }
        }

        // Define starting troop values for each nation's generals
        const nationGenerals = {
            'France': [
                { name: 'Moritz v. Sachsen', rank: 1, troops: 7 },
                { name: 'Belle-Isle', rank: 2, troops: 6 },
                { name: 'Broglie', rank: 3, troops: 5 },
                { name: 'Maillebois', rank: 4 },
                { name: 'Noailles', rank: 5 }
            ],
            'Bavaria': [
                { name: 'Törring', rank: 1, troops: 5 }
            ],
            'Austria': [
                { name: 'Karl v. Lothringen', rank: 1 },
                { name: 'Traun', rank: 2 },
                { name: 'Khevenhüller', rank: 3, troops: 6 },
                { name: 'Batthyány', rank: 4, troops: 2 },
                { name: 'Neipperg', rank: 5 },
                { name: 'Arenberg', rank: 6, troops: 4 }
            ],
            'Prussia': [
                { name: 'Friedrich der Große', rank: 1 },
                { name: 'Schwerin', rank: 2 },
                { name: 'Erbprinz Leopold', rank: 3, troops: 4 },
                { name: 'Der Alte Dessauer', rank: 4, troops: 6 }
            ],
            'Pragmatic Army': [
                { name: 'George II', rank: 1 },
                { name: 'Cumberland', rank: 2 },
                { name: 'Earl of Stair', rank: 3 }
            ],
            'Saxony': [
                { name: 'Rutowski', rank: 1, troops: 5 }
            ]
        };

        function showResetConfirmation() {
            document.getElementById('confirmModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function resetToStartingValues() {
            localStorage.clear();
            closeModal();
            // Show feedback to user
            alert('All troops have been reset to their starting values!');
            // Update button states after reset
            checkNationModifications();
        }

        // Close modal if clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Check for modifications when the page loads
        document.addEventListener('DOMContentLoaded', checkNationModifications);

        function removeSaxony() {
            const message = mainNation === 'prussia' ? 
                'Are you sure you want to remove Saxony? It will become available to Austria.' :
                'Are you sure you want to remove Saxony? It will return to Prussia.';
            
            showModal(
                'Remove Saxony',
                message,
                () => {
                    saxonySwitched = mainNation === 'prussia';
                    localStorage.setItem('saxonySwitched', saxonySwitched);
                    // Store which nation made the change
                    localStorage.setItem('saxonyModifier', mainNation);
                    window.location.reload();
                }
            );
        }

        function addSaxonyToNation(nation) {
            showModal(
                'Add Saxony',
                `Add Saxony to ${nation}?`,
                () => {
                    saxonySwitched = nation === 'Austria';
                    localStorage.setItem('saxonySwitched', saxonySwitched);
                    // Store which nation made the change
                    localStorage.setItem('saxonyModifier', nation.toLowerCase());
                    window.location.reload();
                }
            );
        }
    </script>
</body>
</html> 